<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>SoundManager2_SMSound_AS3.as</title>
  <style type="text/css">
/**
 * http://jashkenas.github.com/docco/resources/docco.css
 */

/*--------------------- Layout and Typography ----------------------------*/
body {
  font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
  font-size: 15px;
  line-height: 22px;
  color: #252519;
  margin: 0; padding: 0;
}
a {
  color: #261a3b;
}
  a:visited {
    color: #261a3b;
  }
p {
  margin: 0 0 15px 0;
}
h1, h2, h3, h4, h5, h6 {
  margin: 0px 0 15px 0;
}
  h1 {
    margin-top: 40px;
  }
#container {
  position: relative;
}
#background {
  position: fixed;
  top: 0; left: 525px; right: 0; bottom: 0;
  background: #f5f5ff;
  border-left: 1px solid #e5e5ee;
  z-index: -1;
}
#jump_to, #jump_page {
  background: white;
  -webkit-box-shadow: 0 0 25px #777; -moz-box-shadow: 0 0 25px #777;
  -webkit-border-bottom-left-radius: 5px; -moz-border-radius-bottomleft: 5px;
  font: 10px Arial;
  text-transform: uppercase;
  cursor: pointer;
  text-align: right;
}
#jump_to, #jump_wrapper {
  position: fixed;
  right: 0; top: 0;
  padding: 5px 10px;
}
  #jump_wrapper {
    padding: 0;
    display: none;
  }
    #jump_to:hover #jump_wrapper {
      display: block;
    }
    #jump_page {
      padding: 5px 0 3px;
      margin: 0 0 25px 25px;
    }
      #jump_page .source {
        display: block;
        padding: 5px 10px;
        text-decoration: none;
        border-top: 1px solid #eee;
      }
        #jump_page .source:hover {
          background: #f5f5ff;
        }
        #jump_page .source:first-child {
        }
table td {
  border: 0;
  outline: 0;
}
  td.docs, th.docs {
    max-width: 450px;
    min-width: 450px;
    min-height: 5px;
    padding: 10px 25px 1px 50px;
    overflow-x: hidden;
    vertical-align: top;
    text-align: left;
  }
    .docs pre {
      margin: 15px 0 15px;
      padding-left: 15px;
    }
    .docs p tt, .docs p code {
      background: #f8f8ff;
      border: 1px solid #dedede;
      font-size: 12px;
      padding: 0 0.2em;
    }
    .pilwrap {
      position: relative;
    }
      .pilcrow {
        font: 12px Arial;
        text-decoration: none;
        color: #454545;
        position: absolute;
        top: 3px; left: -20px;
        padding: 1px 2px;
        opacity: 0;
        -webkit-transition: opacity 0.2s linear;
      }
        td.docs:hover .pilcrow {
          opacity: 1;
        }
  td.code, th.code {
    padding: 14px 15px 16px 25px;
    width: 100%;
    vertical-align: top;
    background: #f5f5ff;
    border-left: 1px solid #e5e5ee;
  }
    pre, tt, code {
      font-size: 12px; line-height: 18px;
      font-family: Menlo, Monaco, Consolas, "Lucida Console", monospace;
      margin: 0; padding: 0;
    }


/*---------------------- Syntax Highlighting -----------------------------*/
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
body .hll { background-color: #ffffcc }
body .c { color: #408080; font-style: italic }  /* Comment */
body .err { border: 1px solid #FF0000 }         /* Error */
body .k { color: #954121 }                      /* Keyword */
body .o { color: #666666 }                      /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 }                     /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 }                     /* Generic.Deleted */
body .ge { font-style: italic }                 /* Generic.Emph */
body .gr { color: #FF0000 }                     /* Generic.Error */
body .gh { color: #000080; font-weight: bold }  /* Generic.Heading */
body .gi { color: #00A000 }                     /* Generic.Inserted */
body .go { color: #808080 }                     /* Generic.Output */
body .gp { color: #000080; font-weight: bold }  /* Generic.Prompt */
body .gs { font-weight: bold }                  /* Generic.Strong */
body .gu { color: #800080; font-weight: bold }  /* Generic.Subheading */
body .gt { color: #0040D0 }                     /* Generic.Traceback */
body .kc { color: #954121 }                     /* Keyword.Constant */
body .kd { color: #954121; font-weight: bold }  /* Keyword.Declaration */
body .kn { color: #954121; font-weight: bold }  /* Keyword.Namespace */
body .kp { color: #954121 }                     /* Keyword.Pseudo */
body .kr { color: #954121; font-weight: bold }  /* Keyword.Reserved */
body .kt { color: #B00040 }                     /* Keyword.Type */
body .m { color: #666666 }                      /* Literal.Number */
body .s { color: #219161 }                      /* Literal.String */
body .na { color: #7D9029 }                     /* Name.Attribute */
body .nb { color: #954121 }                     /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold }  /* Name.Class */
body .no { color: #880000 }                     /* Name.Constant */
body .nd { color: #AA22FF }                     /* Name.Decorator */
body .ni { color: #999999; font-weight: bold }  /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold }  /* Name.Exception */
body .nf { color: #0000FF }                     /* Name.Function */
body .nl { color: #A0A000 }                     /* Name.Label */
body .nn { color: #0000FF; font-weight: bold }  /* Name.Namespace */
body .nt { color: #954121; font-weight: bold }  /* Name.Tag */
body .nv { color: #19469D }                     /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold }  /* Operator.Word */
body .w { color: #bbbbbb }                      /* Text.Whitespace */
body .mf { color: #666666 }                     /* Literal.Number.Float */
body .mh { color: #666666 }                     /* Literal.Number.Hex */
body .mi { color: #666666 }                     /* Literal.Number.Integer */
body .mo { color: #666666 }                     /* Literal.Number.Oct */
body .sb { color: #219161 }                     /* Literal.String.Backtick */
body .sc { color: #219161 }                     /* Literal.String.Char */
body .sd { color: #219161; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #219161 }                     /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold }  /* Literal.String.Escape */
body .sh { color: #219161 }                     /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold }  /* Literal.String.Interpol */
body .sx { color: #954121 }                     /* Literal.String.Other */
body .sr { color: #BB6688 }                     /* Literal.String.Regex */
body .s1 { color: #219161 }                     /* Literal.String.Single */
body .ss { color: #19469D }                     /* Literal.String.Symbol */
body .bp { color: #954121 }                     /* Name.Builtin.Pseudo */
body .vc { color: #19469D }                     /* Name.Variable.Class */
body .vg { color: #19469D }                     /* Name.Variable.Global */
body .vi { color: #19469D }                     /* Name.Variable.Instance */
body .il { color: #666666 }                     /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="../demo/360-player/script/360player.html">360player.js</a>
          <a class="source" href="../demo/flashblock/flashblock.html">flashblock.css</a>
          <a class="source" href="../demo/mp3-player-button/script/mp3-player-button.html">mp3-player-button.js</a>
          <a class="source" href="../demo/mpc/script/mpc.html">mpc.js</a>
          <a class="source" href="../demo/page-player/script/page-player.html">page-player.js</a>
          <a class="source" href="../demo/play-mp3-links/script/inlineplayer.html">inlineplayer.js</a>
          <a class="source" href="../script/soundmanager2.html">soundmanager2.js</a>
          <a class="source" href="SoundManager2.html">SoundManager2.as</a>
          <a class="source" href="SoundManager2_AS3.html">SoundManager2_AS3.as</a>
          <a class="source" href="SoundManager2_SMSound_AS3.html">SoundManager2_SMSound_AS3.as</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>SoundManager2_SMSound_AS3.as</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-SoundManager_2:_Javascript_Sound_for_the_Web'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-SoundManager_2:_Javascript_Sound_for_the_Web">&#182;</a>
        </div>
        <h2>SoundManager 2: Javascript Sound for the Web</h2>

<p>http://schillmania.com/projects/soundmanager2/</p>

<p>Copyright &copy; 2007, Scott Schiller. All rights reserved.
Code licensed under the BSD License:
http://www.schillmania.com/projects/soundmanager2/license.txt</p>

<p>Flash 9 / ActionScript 3 version</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="kd">package</span> <span class="o">{</span>

  <span class="k">import</span> <span class="nn">flash.external.</span><span class="o">*;</span>
  <span class="k">import</span> <span class="nn">flash.events.</span><span class="o">*;</span>
  <span class="k">import</span> <span class="nn">flash.media.Sound</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.media.SoundChannel</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.media.SoundLoaderContext</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.media.SoundTransform</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.media.SoundMixer</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.net.URLRequest</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.utils.ByteArray</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.utils.getTimer</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.net.NetConnection</span><span class="o">;</span>
  <span class="k">import</span> <span class="nn">flash.net.NetStream</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="n">SoundManager2_SMSound_AS3</span> <span class="kd">extends</span> <span class="n">Sound</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">var</span> <span class="n">sm</span><span class="p">:</span> <span class="kt">SoundManager2_AS3</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>externalInterface references (for Javascript callbacks)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">var</span> <span class="n">baseJSController</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s2">&quot;soundManager&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">baseJSObject</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">baseJSController</span> <span class="o">+</span> <span class="s2">&quot;.sounds&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">soundChannel</span><span class="p">:</span> <span class="kt">SoundChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">SoundChannel</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">urlRequest</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">soundLoaderContext</span><span class="p">:</span> <span class="kt">SoundLoaderContext</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">waveformData</span><span class="p">:</span> <span class="kt">ByteArray</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">ByteArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">waveformDataArray</span><span class="p">:</span> <span class="kt">Array</span> <span class="o">=</span> <span class="o">[];</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">eqData</span><span class="p">:</span> <span class="kt">ByteArray</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">ByteArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">eqDataArray</span><span class="p">:</span> <span class="kt">Array</span> <span class="o">=</span> <span class="o">[];</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">usePeakData</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">useWaveformData</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">useEQData</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">sID</span><span class="p">:</span> <span class="kt">String</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">sURL</span><span class="p">:</span> <span class="kt">String</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">didFinish</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">loaded</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">connected</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">failed</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">paused</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">finished</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">duration</span><span class="p">:</span> <span class="kt">Number</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">handledDataError</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">ignoreDataError</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">autoPlay</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">autoLoad</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">pauseOnBufferFull</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// only applies to RTMP</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">loops</span><span class="p">:</span> <span class="kt">Number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">lastValues</span><span class="p">:</span> <span class="kt">Object</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">bytes</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">position</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">duration</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">volume</span><span class="o">:</span> <span class="mi">100</span><span class="o">,</span>
      <span class="n">pan</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">loops</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
      <span class="n">leftPeak</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">rightPeak</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
      <span class="n">waveformDataArray</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
      <span class="n">eqDataArray</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
      <span class="n">isBuffering</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
      <span class="n">bufferLength</span><span class="o">:</span> <span class="mi">0</span>
    <span class="o">};</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">didLoad</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">useEvents</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">sound</span><span class="p">:</span> <span class="kt">Sound</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sound</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">var</span> <span class="n">cc</span><span class="p">:</span> <span class="kt">Object</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">nc</span><span class="p">:</span> <span class="kt">NetConnection</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">ns</span><span class="p">:</span> <span class="kt">NetStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">st</span><span class="p">:</span> <span class="kt">SoundTransform</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">useNetstream</span><span class="p">:</span> <span class="kt">Boolean</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">bufferTime</span><span class="p">:</span> <span class="kt">Number</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span> <span class="c1">// previously 0.1</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">lastNetStatus</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">var</span> <span class="n">serverUrl</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">var</span> <span class="n">checkPolicyFile</span><span class="p">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">SoundManager2_SMSound_AS3</span><span class="o">(</span><span class="n">oSoundManager</span><span class="o">:</span> <span class="kt">SoundManager2_AS3</span><span class="o">,</span> <span class="n">sIDArg</span><span class="o">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sURLArg</span><span class="o">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">usePeakData</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">useWaveformData</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">useEQData</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">useNetstreamArg</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">netStreamBufferTime</span><span class="o">:</span> <span class="kt">Number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">serverUrl</span><span class="o">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">duration</span><span class="o">:</span> <span class="kt">Number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">autoPlay</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">useEvents</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">autoLoad</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">checkPolicyFile</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sm</span> <span class="o">=</span> <span class="n">oSoundManager</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">=</span> <span class="n">sIDArg</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sURL</span> <span class="o">=</span> <span class="n">sURLArg</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">usePeakData</span> <span class="o">=</span> <span class="n">usePeakData</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">useWaveformData</span> <span class="o">=</span> <span class="n">useWaveformData</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">useEQData</span> <span class="o">=</span> <span class="n">useEQData</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">urlRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">URLRequest</span><span class="o">(</span><span class="n">sURLArg</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">didFinish</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">loaded</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">connected</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lastNetStatus</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span> <span class="o">=</span> <span class="n">useNetstreamArg</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">=</span> <span class="n">serverUrl</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">useEvents</span> <span class="o">=</span> <span class="n">useEvents</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">autoLoad</span> <span class="o">=</span> <span class="n">autoLoad</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">netStreamBufferTime</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">bufferTime</span> <span class="o">=</span> <span class="n">netStreamBufferTime</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">this</span><span class="o">.</span><span class="na">checkPolicyFile</span> <span class="o">=</span> <span class="n">checkPolicyFile</span><span class="o">;</span>

      <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;SoundManager2_SMSound_AS3: Got duration: &#39;</span><span class="o">+</span><span class="n">duration</span><span class="o">+</span><span class="s1">&#39;, autoPlay: &#39;</span><span class="o">+</span><span class="n">autoPlay</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Pause on buffer full if auto-loading an RTMP stream</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">autoLoad</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">this</span><span class="o">.</span><span class="na">cc</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Object</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nc</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">NetConnection</span><span class="o">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>Handle FMS bandwidth check callback.
@see onBWDone
@see http://www.adobe.com/devnet/flashmediaserver/articles/dynamic<em>stream</em>switching_04.html
@see http://www.johncblandii.com/index.php/2007/12/fms-a-quick-fix-for-missing-onbwdone-onfcsubscribe-etc.html</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="o">.</span><span class="na">nc</span><span class="o">.</span><span class="na">client</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>TODO: security/IO error handling
this.nc.addEventListener(SecurityErrorEvent.SECURITY_ERROR, doSecurityError);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="n">nc</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">NetStatusEvent</span><span class="o">.</span><span class="na">NET_STATUS</span><span class="o">,</span> <span class="n">netStatusHandler</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;SoundManager2_SMSound_AS3: NetConnection: connecting to server &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nc</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">serverUrl</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">connected</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">netStatusHandler</span><span class="o">(</span><span class="n">event</span><span class="o">:</span><span class="kt">NetStatusEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>

      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">useEvents</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;netStatusHandler: &#39;</span><span class="o">+</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">case</span> <span class="s2">&quot;NetConnection.Connect.Success&quot;</span><span class="o">:</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ns</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">NetStream</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">nc</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">checkPolicyFile</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">checkPolicyFile</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>bufferTime reference: http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/NetStream.html#bufferTime</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">bufferTime</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">bufferTime</span><span class="o">;</span> <span class="c1">// set to 0.1 or higher. 0 is reported to cause playback issues with static files.</span>
            <span class="k">this</span><span class="o">.</span><span class="na">st</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">SoundTransform</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">cc</span><span class="o">.</span><span class="na">onMetaData</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">metaDataHandler</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">cc</span><span class="o">.</span><span class="na">setCaption</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">captionHandler</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">client</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">cc</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">receiveAudio</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">addNetstreamEvents</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">connected</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>RTMP-only</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">useEvents</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;NetConnection: connected&#39;</span><span class="o">);</span>
              <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;firing _onconnect for &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">sID</span><span class="o">);</span>
              <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sm</span><span class="o">.</span><span class="na">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onconnect&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Error</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;netStream error: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;Connection failed!&#39;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="k">break</span><span class="o">;</span>

        <span class="k">case</span> <span class="s2">&quot;NetStream.Play.StreamNotFound&quot;</span><span class="o">:</span>
          <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s2">&quot;NetConnection: Stream not found!&quot;</span><span class="o">);</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;Stream not found!&#39;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>This is triggered when the sound loses the connection with the server.
In some cases one could just try to reconnect to the server and resume playback.
However for streams protected by expiring tokens, I don&rsquo;t think that will work.</p>

<p>Flash says that this is not an error code, but a status code&hellip;
should this call the onFailure handler?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">case</span> <span class="s2">&quot;NetConnection.Connect.Closed&quot;</span><span class="o">:</span>
          <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;Connection closed!&#39;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s2">&quot;NetConnection: Connection closed!&quot;</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Couldn&rsquo;t establish a connection with the server. Attempts to connect to the server
can also fail if the permissible number of socket connections on either the client
or the server computer is at its limit.  This also happens when the internet
connection is lost.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">case</span> <span class="s2">&quot;NetConnection.Connect.Failed&quot;</span><span class="o">:</span>
          <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s2">&quot;NetConnection: Connection failed! Lost internet connection? Try again... Description: &quot;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">description</span><span class="o">);</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;Connection failed!&#39;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>A change has occurred to the network status. This could mean that the network
connection is back, or it could mean that it has been lost&hellip;just try to resume
playback.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>KJV: Can&rsquo;t use this yet because by the time you get your connection back the
song has reached it&rsquo;s maximum retries, so it doesn&rsquo;t retry again.  We need
a new <em>ondisconnect handler.
case &ldquo;NetConnection.Connect.NetworkChange&rdquo;:
 this.failed = true;
 writeDebug(&ldquo;NetConnection: Network connection status changed&rdquo;);
 ExternalInterface.call(baseJSObject + &ldquo;[&lsquo;&rdquo; + this.sID + &ldquo;&rsquo;].</em>onfailure&rdquo;, &lsquo;Reconnecting&hellip;&rsquo;);
 break;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Consider everything else a failure&hellip;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">default</span><span class="o">:</span>
          <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s2">&quot;NetConnection: got unhandled code &#39;&quot;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">+</span> <span class="s2">&quot;&#39;! Description: &quot;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">description</span><span class="o">);</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">writeDebug</span> <span class="o">(</span><span class="n">s</span><span class="o">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">bTimestamp</span><span class="o">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Boolean</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">sm</span><span class="o">.</span><span class="na">writeDebug</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">bTimestamp</span><span class="o">);</span> <span class="c1">// defined in main SM object</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">metaDataHandler</span><span class="o">(</span><span class="n">infoObject</span><span class="o">:</span> <span class="kt">Object</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="kd">var</span> <span class="n">prop</span><span class="p">:</span><span class="kt">String</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">debugEnabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">var</span> <span class="n">data</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">prop</span> <span class="k">in</span> <span class="n">infoObject</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">data</span> <span class="o">+=</span> <span class="n">prop</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">infoObject</span><span class="o">[</span><span class="n">prop</span><span class="o">]+</span><span class="s1">&#39; \n&#39;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;Metadata: &#39;</span><span class="o">+</span><span class="n">data</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">this</span><span class="o">.</span><span class="na">duration</span> <span class="o">=</span> <span class="n">infoObject</span><span class="o">.</span><span class="na">duration</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">loaded</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;not loaded yet: &rsquo;+this.ns.bytesLoaded+&lsquo;, &rsquo;+this.ns.bytesTotal+&lsquo;, &rsquo;+infoObject.duration<em>1000);
TODO: investigate loaded/total values
ExternalInterface.call(baseJSObject + &ldquo;[&lsquo;&rdquo; + this.sID + &ldquo;&rsquo;]._whileloading&rdquo;, this.ns.bytesLoaded, this.ns.bytesTotal, infoObject.duration</em>1000);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._whileloading&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">bytesLoaded</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">bytesTotal</span><span class="o">,</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">duration</span> <span class="o">||</span> <span class="n">infoObject</span><span class="o">.</span><span class="na">duration</span><span class="o">))</span>
      <span class="o">}</span>
      <span class="kd">var</span> <span class="n">metaData</span><span class="p">:</span><span class="kt">Array</span> <span class="o">=</span> <span class="o">[];</span>
      <span class="kd">var</span> <span class="n">metaDataProps</span><span class="p">:</span><span class="kt">Array</span> <span class="o">=</span> <span class="o">[];</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">prop</span> <span class="k">in</span> <span class="n">infoObject</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">metaData</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">prop</span><span class="o">);</span>
        <span class="n">metaDataProps</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">infoObject</span><span class="o">[</span><span class="n">prop</span><span class="o">]);</span>
      <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>pass infoObject to _onmetadata, too</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onmetadata&quot;</span><span class="o">,</span> <span class="n">metaData</span><span class="o">,</span> <span class="n">metaDataProps</span><span class="o">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>this handler may fire multiple times, eg., when a song changes while playing an RTMP stream.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>disconnect for non-RTMP cases, since multiple firings may mess up duration.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="o">.</span><span class="na">cc</span><span class="o">.</span><span class="na">onMetaData</span> <span class="o">=</span> <span class="kd">function</span><span class="o">(</span><span class="n">infoObject</span><span class="o">:</span> <span class="n">Object</span><span class="o">)</span> <span class="o">:</span> <span class="kc">void</span> <span class="o">{}</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">captionHandler</span><span class="o">(</span><span class="n">infoObject</span><span class="o">:</span> <span class="kt">Object</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">debugEnabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">var</span> <span class="n">data</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">var</span> <span class="n">prop</span><span class="o">:*</span> <span class="k">in</span> <span class="n">infoObject</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">data</span> <span class="o">+=</span> <span class="n">prop</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">infoObject</span><span class="o">[</span><span class="n">prop</span><span class="o">]+</span><span class="s1">&#39; \n&#39;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;Caption: &#39;</span><span class="o">+</span><span class="n">data</span><span class="o">);</span>
      <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>null this out for the duration of this object&rsquo;s existence.
it may be called multiple times.
this.cc.setCaption = function(infoObject: Object) : void {}</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    </pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;Caption\n&rsquo;+infoObject[&lsquo;dynamicMetadata&rsquo;]);
writeDebug(&lsquo;firing _oncaptiondata for &rsquo;+this.sID);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sm</span><span class="o">.</span><span class="na">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._oncaptiondata&quot;</span><span class="o">,</span> <span class="n">infoObject</span><span class="o">[</span><span class="s1">&#39;dynamicMetadata&#39;</span><span class="o">]);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">getWaveformData</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/SoundMixer.html#computeSpectrum()</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="n">SoundMixer</span><span class="o">.</span><span class="na">computeSpectrum</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">waveformData</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// sample wave data at 44.1 KHz</span>
      <span class="k">this</span><span class="o">.</span><span class="na">waveformDataArray</span> <span class="o">=</span> <span class="o">[];</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">i</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span><span class="o">:</span> <span class="n">int</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">waveformData</span><span class="o">.</span><span class="na">length</span> <span class="sr">/ 4; i &lt; j; i++) { //</span> <span class="kd">get</span> <span class="n">all</span> <span class="mi">512</span> <span class="n">values</span> <span class="o">(</span><span class="mi">256</span> <span class="n">per</span> <span class="n">channel</span><span class="o">)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">waveformDataArray</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">int</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">waveformData</span><span class="o">.</span><span class="na">readFloat</span><span class="o">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">getEQData</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/SoundMixer.html#computeSpectrum()</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="n">SoundMixer</span><span class="o">.</span><span class="na">computeSpectrum</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">eqData</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// sample EQ data at 44.1 KHz</span>
      <span class="k">this</span><span class="o">.</span><span class="na">eqDataArray</span> <span class="o">=</span> <span class="o">[];</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">i</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span><span class="o">:</span> <span class="n">int</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">eqData</span><span class="o">.</span><span class="na">length</span> <span class="sr">/ 4; i &lt; j; i++) { //</span> <span class="kd">get</span> <span class="n">all</span> <span class="mi">512</span> <span class="n">values</span> <span class="o">(</span><span class="mi">256</span> <span class="n">per</span> <span class="n">channel</span><span class="o">)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">eqDataArray</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">int</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">eqData</span><span class="o">.</span><span class="na">readFloat</span><span class="o">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">start</span><span class="o">(</span><span class="n">nMsecOffset</span><span class="o">:</span> <span class="kt">int</span><span class="o">,</span> <span class="n">nLoops</span><span class="o">:</span> <span class="kt">int</span><span class="o">,</span> <span class="n">allowMultiShot</span><span class="o">:</span><span class="kt">Boolean</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Boolean</span> <span class="o">{</span>

      <span class="k">this</span><span class="o">.</span><span class="na">useEvents</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">writeDebug</span><span class="o">(</span><span class="s2">&quot;SMSound::start nMsecOffset &quot;</span><span class="o">+</span> <span class="n">nMsecOffset</span><span class="o">+</span> <span class="s1">&#39; nLoops &#39;</span><span class="o">+</span><span class="n">nLoops</span> <span class="o">+</span> <span class="s1">&#39; current bufferTime &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">bufferTime</span><span class="o">+</span><span class="s1">&#39; current bufferLength &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">bufferLength</span><span class="o">+</span> <span class="s1">&#39; this.lastValues.position &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">position</span><span class="o">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>mark for later Netstream.Play.Stop / sound completion</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="k">this</span><span class="o">.</span><span class="na">cc</span><span class="o">.</span><span class="na">onMetaData</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">metaDataHandler</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Don&rsquo;t seek if we don&rsquo;t have to because it destroys the buffer</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="kd">var</span> <span class="n">set_position</span><span class="p">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">position</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">position</span> <span class="o">!=</span> <span class="n">nMsecOffset</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">set_position</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Minimize the buffer so playback starts ASAP</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">bufferTime</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">bufferTime</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">paused</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;start: resuming from paused state&#39;</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">resume</span><span class="o">();</span> <span class="c1">// get the sound going again</span>
          <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">didLoad</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">didLoad</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="k">this</span><span class="o">.</span><span class="na">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">didLoad</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;start: !didLoad - playing &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">sURL</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sURL</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// SAS: playing behaviour overrides buffering behaviour</span>
          <span class="k">this</span><span class="o">.</span><span class="na">didLoad</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>previously loaded, perhaps stopped/finished. play again?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;playing again (not paused, didLoad = true)&#39;</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sURL</span><span class="o">);</span>
        <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>KJV seek after calling play otherwise some streams get a NetStream.Seek.Failed
Should only apply to the !didLoad case, but do it for all for simplicity.
nMsecOffset is in milliseconds for streams but in seconds for progressive
download.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(</span><span class="n">set_position</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">seek</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">?</span> <span class="n">nMsecOffset</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">:</span> <span class="n">nMsecOffset</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">position</span> <span class="o">=</span> <span class="n">nMsecOffset</span><span class="o">;</span> <span class="c1">// https://gist.github.com/1de8a3113cf33d0cff67</span>
        <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>this.ns.addEventListener(Event.SOUND_COMPLETE, _onfinish);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>

      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;start: seeking to &rsquo;+nMsecOffset+&lsquo;, &rsquo;+nLoops+(nLoops==1?&lsquo; loop&rsquo;:&lsquo; loops&rsquo;));</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span> <span class="o">||</span> <span class="n">allowMultiShot</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="n">nMsecOffset</span><span class="o">,</span> <span class="n">nLoops</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">SOUND_COMPLETE</span><span class="o">,</span> <span class="n">_onfinish</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;start: was already playing, no-multishot case. Seeking to &rsquo;+nMsecOffset+&lsquo;, &rsquo;+nLoops+(nLoops==1?&lsquo; loop&rsquo;:&lsquo; loops&rsquo;));
already playing and no multi-shot allowed, so re-start and set position</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
          <span class="o">}</span>
          <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="n">nMsecOffset</span><span class="o">,</span> <span class="n">nLoops</span><span class="o">);</span> <span class="c1">// start playing at new position</span>
          <span class="k">this</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">SOUND_COMPLETE</span><span class="o">,</span> <span class="n">_onfinish</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>if soundChannel is null (and not a netStream), there is no sound card (or 32-channel ceiling has been hit.)
http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/media/Sound.html#play%28%29</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">return</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">function </span><span class="nf">_onfinish</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">removeEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">SOUND_COMPLETE</span><span class="o">,</span> <span class="n">_onfinish</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">loadSound</span><span class="o">(</span><span class="n">sURL</span><span class="o">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">useEvents</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">didLoad</span> <span class="o">!=</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sURL</span><span class="o">);</span> <span class="c1">// load streams by playing them</span>
          <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">autoPlay</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="k">this</span><span class="o">.</span><span class="na">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>this.addEventListener(Event.SOUND_COMPLETE, _onfinish);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">didLoad</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">urlRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">URLRequest</span><span class="o">(</span><span class="n">sURL</span><span class="o">);</span>
          <span class="k">this</span><span class="o">.</span><span class="na">soundLoaderContext</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">SoundLoaderContext</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">checkPolicyFile</span><span class="o">);</span> <span class="c1">// check for policy (crossdomain.xml) file on remote domains - http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/SoundLoaderContext.html</span>
          <span class="k">this</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">urlRequest</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">soundLoaderContext</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Error</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;error during loadSound(): &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Set the value of autoPlay</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">setAutoPlay</span><span class="o">(</span><span class="n">autoPlay</span><span class="o">:</span> <span class="kt">Boolean</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">autoPlay</span> <span class="o">=</span> <span class="n">autoPlay</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">autoPlay</span> <span class="o">=</span> <span class="n">autoPlay</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">autoPlay</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">autoPlay</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">setVolume</span><span class="o">(</span><span class="n">nVolume</span><span class="o">:</span> <span class="kt">Number</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">volume</span> <span class="o">=</span> <span class="n">nVolume</span> <span class="o">/</span> <span class="mi">100</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">setPan</span><span class="o">(</span><span class="n">nPan</span><span class="o">:</span> <span class="kt">Number</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">pan</span> <span class="o">=</span> <span class="n">nPan</span> <span class="o">/</span> <span class="mi">100</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">applyTransform</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">applyTransform</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="kd">var</span> <span class="n">st</span><span class="p">:</span> <span class="kt">SoundTransform</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">SoundTransform</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">volume</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">pan</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">soundTransform</span> <span class="o">=</span> <span class="n">st</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;applyTransform(): Note: No active netStream&rsquo;);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="o">}</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">soundChannel</span><span class="o">.</span><span class="na">soundTransform</span> <span class="o">=</span> <span class="n">st</span><span class="o">;</span> <span class="c1">// new SoundTransform(this.lastValues.volume, this.lastValues.pan);</span>
      <span class="o">}</span>
    <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>Handle FMS bandwidth check callback.
@see http://www.adobe.com/devnet/flashmediaserver/articles/dynamic<em>stream</em>switching_04.html
@see http://www.johncblandii.com/index.php/2007/12/fms-a-quick-fix-for-missing-onbwdone-onfcsubscribe-etc.html</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">onBWDone</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>writeDebug(&lsquo;onBWDone: called and ignored&rsquo;);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>NetStream client callback. Invoked when the song is complete.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">onPlayStatus</span><span class="o">(</span><span class="n">info</span><span class="o">:</span><span class="kt">Object</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
      <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;onPlayStatus called with &#39;</span><span class="o">+</span><span class="n">info</span><span class="o">);</span>
      <span class="k">switch</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">case</span> <span class="s2">&quot;NetStream.Play.Complete&quot;</span><span class="o">:</span>
          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;Song has finished!&#39;</span><span class="o">);</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">doIOError</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="kt">IOErrorEvent</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onload&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// call onload, assume it failed.</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>there was a connection drop, a loss of internet connection, or something else wrong. 404 error too.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">doAsyncError</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="kt">AsyncErrorEvent</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;asyncError: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">doNetStatus</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="kt">NetStatusEvent</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-37'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-37">&#182;</a>
        </div>
        <p>Handle failures</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Failed&quot;</span>
          <span class="o">||</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Play.FileStructureInvalid&quot;</span>
          <span class="o">||</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Play.StreamNotFound&quot;</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">this</span><span class="o">.</span><span class="na">lastNetStatus</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">;</span>
        <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;netStatusEvent: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">failed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfailure&quot;</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">level</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;netStatusEvent: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>  <span class="c1">// KJV we like to see all events</span></pre></div>
      </td>
    </tr>
    <tr id='section-38'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-38">&#182;</a>
        </div>
        <p>When streaming, Stop is called when buffering stops, not when the stream is actually finished.
@see http://www.actionscript.org/forums/archive/index.php3/t-159194.html</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Play.Stop&quot;</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">useNetstream</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span><span class="o">))</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>finished playing, and not RTMP</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;calling onfinish for a sound&#39;</span><span class="o">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-40'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-40">&#182;</a>
        </div>
        <p>reset the sound? Move back to position 0?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="k">this</span><span class="o">.</span><span class="na">sm</span><span class="o">.</span><span class="na">checkProgress</span><span class="o">();</span>
          <span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// will be reset via JS callback</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfinish&quot;</span><span class="o">);</span>

        <span class="o">}</span>

      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Play.Start&quot;</span> <span class="o">||</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Empty&quot;</span> <span class="o">||</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Full&quot;</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-41'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-41">&#182;</a>
        </div>
        <p>RTMP case..
We wait for the buffer to fill up before pausing the just-loaded song because only if the
buffer is full will the song continue to buffer until the user hits play.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverUrl</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Full&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span>
          <span class="k">this</span><span class="o">.</span><span class="na">paused</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">pauseOnBufferFull</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-42'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-42">&#182;</a>
        </div>
        <p>Call pause in JS.  This will call back to us to pause again, but
that should be harmless.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;Pausing on buffer full&#39;</span><span class="o">);</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;].pause&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">var</span> <span class="n">isNetstreamBuffering</span><span class="p">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Empty&quot;</span> <span class="o">||</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Play.Start&quot;</span><span class="o">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-43'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-43">&#182;</a>
        </div>
        <p>assume buffering when we start playing, eg. initial load.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(</span><span class="n">isNetstreamBuffering</span> <span class="o">!=</span> <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">isBuffering</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">isBuffering</span> <span class="o">=</span> <span class="n">isNetstreamBuffering</span><span class="o">;</span>
          <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onbufferchange&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">lastValues</span><span class="o">.</span><span class="na">isBuffering</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-44'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-44">&#182;</a>
        </div>
        <p>We can detect the end of the stream when Play.Stop is called followed by Buffer.Empty.
However, if you pause and let the whole song buffer, Buffer.Flush is called followed by
Buffer.Empty, so handle that case too.</p>

<p>Ignore this event if we are more than 3 seconds from the end of the song.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Empty&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">lastNetStatus</span> <span class="o">==</span> <span class="s1">&#39;NetStream.Play.Stop&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">lastNetStatus</span> <span class="o">==</span> <span class="s1">&#39;NetStream.Buffer.Flush&#39;</span><span class="o">))</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">duration</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">time</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">&lt;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">duration</span> <span class="o">-</span> <span class="mi">3000</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;Ignoring Buffer.Empty because this is too early to be the end of the stream! (sID: &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">sID</span><span class="o">+</span><span class="s1">&#39;, time: &#39;</span><span class="o">+(</span><span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">time</span><span class="o">*</span><span class="mi">1000</span><span class="o">)+</span><span class="s1">&#39;, duration: &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">duration</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="o">);</span>
          <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">finished</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="n">writeDebug</span><span class="o">(</span><span class="s1">&#39;calling onfinish for sound &#39;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">sID</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">sm</span><span class="o">.</span><span class="na">checkProgress</span><span class="o">();</span>
            <span class="n">ExternalInterface</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">baseJSObject</span> <span class="o">+</span> <span class="s2">&quot;[&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">sID</span> <span class="o">+</span> <span class="s2">&quot;&#39;]._onfinish&quot;</span><span class="o">);</span>
          <span class="o">}</span>

        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="s2">&quot;NetStream.Buffer.Empty&quot;</span><span class="o">)</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-45'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-45">&#182;</a>
        </div>
        <p>The buffer is empty.  Start from the smallest buffer again.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="k">this</span><span class="o">.</span><span class="na">ns</span><span class="o">.</span><span class="na">bufferTime</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">bufferTime</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-46'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-46">&#182;</a>
        </div>
        <p>Remember the last NetStatus event</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">this</span><span class="o">.</span><span class="na">lastNetStatus</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">;</span>
    <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-47'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-47">&#182;</a>
        </div>
        <p>KJV The sound adds some of its own netstatus handlers so we don&rsquo;t need to do it here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">addNetstreamEvents</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">AsyncErrorEvent</span><span class="o">.</span><span class="na">ASYNC_ERROR</span><span class="o">,</span> <span class="n">doAsyncError</span><span class="o">);</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">NetStatusEvent</span><span class="o">.</span><span class="na">NET_STATUS</span><span class="o">,</span> <span class="n">doNetStatus</span><span class="o">);</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">IOErrorEvent</span><span class="o">.</span><span class="na">IO_ERROR</span><span class="o">,</span> <span class="n">doIOError</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">function </span><span class="nf">removeNetstreamEvents</span><span class="o">()</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">removeEventListener</span><span class="o">(</span><span class="n">AsyncErrorEvent</span><span class="o">.</span><span class="na">ASYNC_ERROR</span><span class="o">,</span> <span class="n">doAsyncError</span><span class="o">);</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">removeEventListener</span><span class="o">(</span><span class="n">NetStatusEvent</span><span class="o">.</span><span class="na">NET_STATUS</span><span class="o">,</span> <span class="n">doNetStatus</span><span class="o">);</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">NetStatusEvent</span><span class="o">.</span><span class="na">NET_STATUS</span><span class="o">,</span> <span class="n">dummyNetStatusHandler</span><span class="o">);</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">removeEventListener</span><span class="o">(</span><span class="n">IOErrorEvent</span><span class="o">.</span><span class="na">IO_ERROR</span><span class="o">,</span> <span class="n">doIOError</span><span class="o">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p>KJV Stop listening for NetConnection events on the sound</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="n">nc</span><span class="o">.</span><span class="na">removeEventListener</span><span class="o">(</span><span class="n">NetStatusEvent</span><span class="o">.</span><span class="na">NET_STATUS</span><span class="o">,</span> <span class="n">netStatusHandler</span><span class="o">);</span>
    <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-49'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-49">&#182;</a>
        </div>
        <p>Prevents possible &lsquo;Unhandled NetStatusEvent&rsquo; condition if a sound is being
destroyed and interacted with at the same time.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">dummyNetStatusHandler</span><span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="kt">NetStatusEvent</span><span class="o">)</span> <span class="o">:</span> <span class="kt">void</span> <span class="o">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-50'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-50">&#182;</a>
        </div>
        <p>Don&rsquo;t do anything</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
